{{- if and (.Values.grafanaProvisioning.enabled | default "false")  (.Values.grafanaProvisioning.dashboards.enabled | default "false") }}
{{- range $path, $_ :=  .Files.Glob  "dashboards/*.json" }}
{{- $dashboardFileName := $path | trimPrefix "dashboards/" }}
{{- $dashboardName := $dashboardFileName | trimSuffix ".json" }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ $dashboardName }}
  namespace: {{ $.Release.Namespace }}
  labels:
    {{ $.Values.grafanaProvisioning.dashboards.label }}: {{ quote $.Values.grafanaProvisioning.dashboards.labelValue }}
data:
  {{ $dashboardFileName }}: |- 
    {{ $.Files.Get $path | nindent 4 }}
---
{{- end }}
{{- end }}